(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/place-order/index"],{"0aa2":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{staticClass:"content",attrs:{"report-submit":"true",eventid:"54e9e55d-18"},on:{submit:t.toPay}},[s("view",{staticClass:"content-top"},[1==t.storeSwitch?s("uni-segmented-control",{attrs:{current:t.type_current,values:t.type_items,"style-type":"text","active-color":"#333",eventid:"54e9e55d-0",mpcomid:"54e9e55d-0"},on:{clickItem:t.onTypeItem}}):t._e(),s("view",{staticClass:"content"},[s("view",{directives:[{name:"show",rawName:"v-show",value:0===t.type_current,expression:"type_current === 0"}]},[t.userShip.id?s("view",{staticClass:"cell-group margin-cell-group",attrs:{eventid:"54e9e55d-2"},on:{click:t.showAddressList}},[s("view",{staticClass:"cell-item add-title-item right-img"},[s("view",{staticClass:"cell-item-hd"},[s("image",{staticClass:"cell-hd-icon",attrs:{src:"/static/image/location.png"}})]),s("view",{staticClass:"cell-item-bd"},[s("view",{staticClass:"cell-bd-view"},[s("text",{staticClass:"cell-bd-text"},[t._v("收货人："+t._s(t.userShip.name))]),s("text",{staticClass:"cell-bd-text-right"},[t._v(t._s(t.userShip.mobile))])]),s("view",{staticClass:"cell-bd-view"},[s("text",{staticClass:"cell-bd-text address"},[t._v(t._s(t.userShip.area_name))])])]),s("view",{staticClass:"cell-item-ft"},[s("image",{staticClass:"cell-ft-next icon",attrs:{src:"/static/image/right.png"}})])])]):s("view",{staticClass:"cell-group margin-cell-group"},[s("view",{staticClass:"cell-item add-title-items"},[s("button",{staticClass:"btn btn-b",attrs:{"hover-class":"btn-hover2",eventid:"54e9e55d-1"},on:{click:function(e){t.goAddress()}}},[t._v("添加收货地址")])],1)])]),s("view",{directives:[{name:"show",rawName:"v-show",value:1===t.type_current,expression:"type_current === 1"}]},[0!=t.store.id?s("view",{staticClass:"cell-group margin-cell-group",attrs:{eventid:"54e9e55d-3"},on:{click:function(e){t.goStorelist()}}},[s("view",{staticClass:"cell-item add-title-item right-img"},[s("view",{staticClass:"cell-item-hd"},[s("image",{staticClass:"cell-hd-icon",attrs:{src:"/static/image/homepage.png"}})]),s("view",{staticClass:"cell-item-bd"},[s("view",{staticClass:"cell-bd-view"},[s("text",{staticClass:"cell-bd-text"},[t._v(t._s(t.store.name))]),s("text",{staticClass:"cell-bd-text-right"},[t._v(t._s(t.store.mobile))])]),s("view",{staticClass:"cell-bd-view"},[s("text",{staticClass:"cell-bd-text address"},[t._v(t._s(t.store.address))])])]),s("view",{staticClass:"cell-item-ft"},[s("image",{staticClass:"cell-ft-next icon",attrs:{src:"/static/image/right.png"}})])])]):s("view",{staticClass:"cell-group margin-cell-group"},[s("view",{staticClass:"cell-item add-title-item right-img no-store"},[t._v("暂无门店")])])])]),1==t.storeSwitch&&1===t.type_current?s("view",{staticClass:"cell-group margin-cell-group"},[s("view",{staticClass:"cell-item user-head"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-hd-title"},[t._v("姓名")])]),s("view",{staticClass:"cell-item-bd"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.store_pick.name,expression:"store_pick.name"}],staticClass:"cell-bd-input",attrs:{placeholder:"请输入提货人姓名",eventid:"54e9e55d-4"},domProps:{value:t.store_pick.name},on:{input:function(e){e.target.composing||(t.store_pick.name=e.target.value)}}})])]),s("view",{staticClass:"cell-item"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-hd-title"},[t._v("电话")])]),s("view",{staticClass:"cell-item-bd"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.store_pick.mobile,expression:"store_pick.mobile"}],staticClass:"cell-bd-input",attrs:{placeholder:"请输入提货人电话",eventid:"54e9e55d-5"},domProps:{value:t.store_pick.mobile},on:{input:function(e){e.target.composing||(t.store_pick.mobile=e.target.value)}}})])])]):t._e(),s("view",{staticClass:"img-list"},t._l(t.products,function(e,i){return 1==e.is_select?s("view",{key:i,staticClass:"img-list-item"},[s("image",{staticClass:"img-list-item-l little-img have-none",attrs:{src:e.products.image_path,mode:"aspectFill"}}),s("view",{staticClass:"img-list-item-r little-right"},[s("view",{staticClass:"little-right-t"},[s("view",{staticClass:"goods-name list-goods-name",attrs:{eventid:"54e9e55d-6-"+i},on:{click:function(s){t.goodsDetail(e.products.goods_id)}}},[t._v(t._s(e.products.name))]),s("view",{staticClass:"goods-price"},[t._v("￥"+t._s(e.products.price))])]),e.products.promotion_list?s("view",{staticClass:"romotion-tip"},t._l(e.products.promotion_list,function(e,i){return s("view",{key:i,staticClass:"romotion-tip-item",class:2!==e.type?"bg-gray":""},[t._v(t._s(e.name))])})):t._e(),s("view",{staticClass:"goods-item-c"},[s("view",{staticClass:"goods-buy"},[null!==e.products.spes_desc?s("view",{staticClass:"goods-salesvolume"},[t._v(t._s(e.products.spes_desc))]):t._e(),s("view",{staticClass:"goods-num"},[t._v("× "+t._s(e.nums))])])])])]):t._e()})),s("view",{staticClass:"cell-group"},[s("view",{staticClass:"cell-item"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-hd-title"},[t._v("优惠券")])]),s("view",{staticClass:"cell-item-ft"},[s("text",{staticClass:"cell-ft-p",attrs:{eventid:"54e9e55d-7"},on:{click:function(e){t.toshow()}}},[t._v(t._s(t.usedCouponsCompute))])])]),1===t.isOpenPoint&&t.userPointNums>0?s("view",{staticClass:"cell-item add-title-item right-img"},[s("view",{staticClass:"cell-item-bd"},[s("view",{staticClass:"cell-bd-view"},[t._v("积分抵扣")]),s("view",{staticClass:"cell-bd-view"},[s("text",{staticClass:"cell-bd-text address color-9"},[t._v("可用 "+t._s(t.canUsePoint)+" 积分，可抵扣 "+t._s(t.pointMoney)+" 元，共有 "+t._s(t.userPointNums)+" 积分。")])])]),s("view",{staticClass:"cell-item-ft",attrs:{eventid:"54e9e55d-8"},on:{click:t.changePointHandle}},[s("label",{staticClass:"radio"},[s("radio",{attrs:{value:"1",checked:t.isUsePoint,color:"#FF7159"}})],1)],1)]):t._e(),1==t.invoiceSwitch?s("view",{staticClass:"cell-item invoice right-img"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-hd-title"},[t._v("发票")])]),s("view",{staticClass:"cell-item-ft",attrs:{eventid:"54e9e55d-9"},on:{click:function(e){t.goInvoice()}}},[s("image",{staticClass:"cell-ft-next icon",attrs:{src:"/static/image/right.png"}}),s("text",{staticClass:"cell-ft-text"},[t._v(t._s(t.invoice.name))])])]):t._e(),s("view",{staticClass:"cell-item"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-bd-view"},[t._v("商品价格")]),t.cartData.goods_pmt_old>0?s("view",{staticClass:"cell-bd-view"},[t._v("商品优惠")]):t._e(),t.cartData.order_pmt_old>0?s("view",{staticClass:"cell-hd-view"},[t._v("订单优惠")]):t._e(),t.couponIsUsed?t._e():s("view",{staticClass:"cell-hd-view"},[t._v("优惠券抵扣")]),t.cartData.point>0?s("view",{staticClass:"cell-hd-view"},[t._v("积分抵扣")]):t._e(),s("view",{staticClass:"cell-hd-view"},[t._v("运费")])]),s("view",{staticClass:"cell-item-ft"},[s("view",{staticClass:"cell-ft-view red-price"},[t._v(t._s(t.cartData.goods_amount))]),t.cartData.goods_pmt_old>0?s("view",{staticClass:"cell-ft-view"},[t._v("-"+t._s(t.cartData.goods_pmt))]):t._e(),t.cartData.order_pmt_old>0?s("view",{staticClass:"cell-ft-view"},[t._v("-"+t._s(t.cartData.order_pmt))]):t._e(),t.couponIsUsed?t._e():s("view",{staticClass:"cell-ft-view"},[t._v("-"+t._s(t.cartData.coupon_pmt))]),t.cartData.point>0?s("view",{staticClass:"cell-ft-view"},[t._v("-"+t._s(t.cartData.point_money))]):t._e(),s("view",{staticClass:"cell-ft-view"},[t._v(t._s(t.cartData.cost_freight))])])])]),s("view",{staticClass:"cell-group leave-message"},[s("view",{staticClass:"cell-item right-img"},[s("view",{staticClass:"cell-item-hd"},[s("view",{staticClass:"cell-hd-title"},[t._v("买家留言")])])]),s("view",{staticClass:"cell-textarea "},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.memo,expression:"memo"}],attrs:{placeholder:"50字以内(选填)",eventid:"54e9e55d-10"},domProps:{value:t.memo},on:{input:function(e){e.target.composing||(t.memo=e.target.value)}}})])])],1),s("lvv-popup",{ref:"lvvpopref",attrs:{position:"bottom",mpcomid:"54e9e55d-2"}},[s("view",{staticStyle:{width:"100%",height:"700rpx",background:"#F8F8F8",position:"absolute",left:"0",bottom:"0"}},[s("view",{staticClass:"pop-c"},[s("view",{staticClass:"pop-b"},[s("view",{staticClass:"pop-b-t"},[s("uni-segmented-control",{attrs:{current:t.current,values:t.items,"style-type":"text","active-color":"#333",eventid:"54e9e55d-11",mpcomid:"54e9e55d-1"},on:{clickItem:t.onClickItem}})],1),s("view",{directives:[{name:"show",rawName:"v-show",value:0===t.current,expression:"current === 0"}]},[t.userCoupons.length?s("scroll-view",{staticClass:"coupon-c",attrs:{"scroll-y":"true"}},t._l(t.userCoupons,function(e,i){return s("view",{key:i,staticClass:"coupon-c-item"},[s("view",{class:e.cla},[s("view",{staticClass:"cci-l-c color-f"},[t._v("coupon")])]),s("view",{staticClass:"cci-r"},[s("view",{staticClass:"cci-r-c"},[s("view",{staticClass:"ccirc-t color-9"},[t._v(t._s(e.name))]),s("view",{staticClass:"ccirc-b"},[s("view",{staticClass:"ccirc-b-l"},[s("view",{staticClass:"ccirc-b-tip"},[t._v(t._s(e.expression1+e.expression2))]),s("view",{staticClass:"ccirc-b-time color-9"},[t._v("有效期："+t._s(e.stime+" - "+e.etime))])]),e.checked||e.disabled?e.checked&&!e.disabled?s("view",{staticClass:"ccirc-b-r color-f",attrs:{eventid:"54e9e55d-12-"+i},on:{click:function(e){t.couponHandle(i)}}},[t._v("取消使用")]):t._e():s("view",{staticClass:"ccirc-b-r color-f",attrs:{eventid:"54e9e55d-13-"+i},on:{click:function(e){t.couponHandle(i)}}},[t._v("立即使用")])])])])])})):s("view",{staticClass:"coupon-none"},[s("image",{staticClass:"coupon-none-img",attrs:{src:"/static/image/order.png",mode:""}})])],1),s("view",{directives:[{name:"show",rawName:"v-show",value:1===t.current,expression:"current === 1"}],staticClass:"coupon-c"},[s("view",{staticClass:"coupon-enter"},[s("view",{staticClass:"coupon-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.inputCouponCode,expression:"inputCouponCode"}],attrs:{type:"text",placeholder:"请输入优惠券码",eventid:"54e9e55d-14"},domProps:{value:t.inputCouponCode},on:{input:function(e){e.target.composing||(t.inputCouponCode=e.target.value)}}})]),s("view",{staticClass:"coupon-enter-btn",attrs:{eventid:"54e9e55d-15"},on:{click:t.useInputCouponCode}},[s("button",{staticClass:"btn btn-b"},[t._v("确认")])],1)])])]),s("view",{staticClass:"button-bottom"},[s("button",{staticClass:"btn btn-square",attrs:{eventid:"54e9e55d-16"},on:{click:function(e){t.notUseCoupon()}}},[t._v("不使用优惠卷")]),s("button",{staticClass:"btn btn-square btn-b",attrs:{eventid:"54e9e55d-17"},on:{click:function(e){t.toclose()}}},[t._v("确定")])],1)])])]),s("view",{staticClass:"button-bottom"},[s("view",{staticClass:"button-bottom-c"},[s("view",{staticClass:"button-bottom-c-t"},[t._v("共 "+t._s(t.productNums)+" 件商品")]),s("view",{staticClass:"button-bottom-c-b"},[t._v("合计"),s("text",{staticClass:"red-price"},[t._v(t._s(t.cartData.amount))])])]),s("button",{staticClass:"btn btn-square btn-b",attrs:{"hover-class":"btn-hover2","form-type":"submit",disabled:t.submitStatus,loading:t.submitStatus}},[t._v("立即支付")])],1)],1)},o=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return o})},"1c90":function(t,e,s){},"2e5a":function(t,e,s){"use strict";s.r(e);var i=s("3cf4"),o=s.n(i);for(var a in i)"default"!==a&&function(t){s.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},"3cf4":function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=c(s("f557")),o=c(s("0efe")),a=s("1fc7");function c(t){return t&&t.__esModule?t:{default:t}}var n={mixins:[a.goods],data:function(){return{type_items:["快递配送","门店自提"],type_current:0,cartData:{},products:[],promotions:[],userShip:{},receiptType:1,params:{ids:0,area_id:0,coupon_code:"",point:0,type:1},invoice:{type:"1",name:"不开发票",code:""},memo:"",items:["选择优惠券","输入券码"],orderType:1,current:0,isUsePoint:!1,userPointNums:0,canUsePoint:0,pointMoney:"",userCoupons:[],usedCoupons:{},inputCouponCode:"",optCoupon:"",store:{id:0,name:"",mobile:"",address:""},store_pick:{name:"",mobile:""},team_id:0,submitStatus:!1}},components:{lvvPopup:i.default,uniSegmentedControl:o.default},onLoad:function(e){var s=e.cart_ids;e.order_type&&(this.params.order_type=e.order_type),e.team_id&&(this.team_id=e.team_id),this.params.ids=JSON.parse(s),this.params.ids||this.$common.successToShow("获取失败",function(){t.navigateBack({delta:1})}),this.userDefaultShip(),this.getUserCounpons(),this.getDefaultStore()},methods:{onTypeItem:function(t){this.type_current!==t&&(this.type_current=t);var e=1;0!=this.type_current&&(e=2),this.receiptType=e,this.getCartList()},goStorelist:function(){t.navigateTo({url:"./storelist"})},goAddress:function(){t.navigateTo({url:"/pages/member/address/list?type=order"})},userDefaultShip:function(){var t=this;this.$api.userDefaultShip({},function(e){e.status&&Object.keys(e.data).length&&(t.userShip=e.data,t.params.area_id=t.userShip.area_id)})},getCartList:function(){var t=this,e=this.params;e["receipt_type"]=this.receiptType,this.$api.cartList(e,function(e){if(e.status){var s=e.data;if(1===t.isOpenPoint&&!t.isUsePoint){var i={order_money:s.amount};t.$api.usablePoint(i,function(e){e.status&&(t.userPointNums=e.data,t.canUsePoint=e.available_point,t.pointMoney=e.point_rmb)})}s.amount=t.$common.formatMoney(s.amount),s.goods_amount=t.$common.formatMoney(s.goods_amount),s.goods_pmt_old=s.goods_pmt,s.goods_pmt=t.$common.formatMoney(s.goods_pmt),s.coupon_pmt=t.$common.formatMoney(s.coupon_pmt),s.order_pmt_old=s.order_pmt,s.order_pmt=t.$common.formatMoney(s.order_pmt),s.point_money=t.$common.formatMoney(s.point_money),s.cost_freight=t.$common.formatMoney(s.cost_freight),t.cartData=s,t.products=s.list,t.promotions=s.promotion_list,t.usedCoupons=s.coupon,1===t.current&&t.$refs.lvvpopref.popshow&&t.inputCouponCode&&t.toclose(),t.inputCouponCode="",t.optCoupon=""}else t.$common.errorToShow(e.msg,function(){var s=[15009,15010,15013,15014,15015];-1!==s.indexOf(e.data)&&(1===t.current?t.removeCouponCode(t.inputCouponCode,t.current):(t.optCoupon&&t.userCoupons.forEach(function(e){e.coupon_code===t.optCoupon&&(e.checked=!1)}),t.removeCouponCode(t.optCoupon,t.current)))})})},getUserCounpons:function(){var t=this,e={display:"no_used"};this.$api.userCoupon(e,function(e){if(e.status){var s=e.data.list,i=Math.round((new Date).getTime()/1e3).toString();s.forEach(function(e){t.$set(e,"checked",!1),t.$set(e,"disabled",e.start_time>i),t.$set(e,"cla",e.disabled?"cci-l bg-c":"cci-l")}),t.userCoupons=s}})},couponHandle:function(t){this.userCoupons[t].checked=!this.userCoupons[t].checked,this.optCoupon=this.userCoupons[t].coupon_code;var e=[];if(this.userCoupons.forEach(function(t){t.checked&&e.push(t.coupon_code)}),this.userCoupons[t].checked)this.params.coupon_code=e.join();else{var s=this.params.coupon_code.split(","),i=s.indexOf(this.userCoupons[t].coupon_code);-1!==i&&(s.splice(i,1),this.params.coupon_code=s.join())}},useInputCouponCode:function(){this.inputCouponCode?this.params.coupon_code.length>0?this.params.coupon_code+=","+this.inputCouponCode:this.params.coupon_code=this.inputCouponCode:this.$common.errorToShow("请输入优惠券码")},notUseCoupon:function(){this.toclose(),this.inputCouponCode="",this.userCoupons.forEach(function(t){t.checked=!1}),this.params.coupon_code=""},removeCouponCode:function(t,e){var s=this.params.coupon_code.split(",");s.splice(s.indexOf(t),1),0===e?this.optCoupon="":this.inputCouponCode="",this.params.coupon_code=s.join()},changePointHandle:function(){this.userPointNums>0&&(this.isUsePoint=!this.isUsePoint,this.params.point=this.isUsePoint?this.canUsePoint:0)},toshow:function(){this.$refs.lvvpopref.show()},toclose:function(){this.$refs.lvvpopref.close()},toPay:function(t){var e=this;this.submitStatus=!0;var s=1;0!=this.type_current&&(s=2),this.receiptType=s;var i={cart_ids:this.params.ids,memo:this.memo,coupon_code:this.params.coupon_code,point:this.params.point,receipt_type:this.receiptType};i["order_type"]=this.params.order_type,0!=this.team_id&&(i["params"]=JSON.stringify({team_id:this.team_id}));var o={};if(1==this.receiptType){if(!this.userShip.id||!this.params.area_id)return this.$common.errorToShow("请选择收货地址"),this.submitStatus=!1,!1;o={uship_id:this.userShip.id,area_id:this.params.area_id}}if(2==this.receiptType){if(!this.store.id)return this.$common.errorToShow("请选择自提门店"),this.submitStatus=!1,!1;if(!this.store_pick.name)return this.$common.errorToShow("请输入提货人姓名"),this.submitStatus=!1,!1;if(!this.store_pick.mobile)return this.$common.errorToShow("请输入提货人电话"),this.submitStatus=!1,!1;o={store_id:this.store.id,lading_name:this.store_pick.name,lading_mobile:this.store_pick.mobile}}i["tax_type"]=this.invoice.type,i["tax_name"]=this.invoice.name,i["tax_code"]=this.invoice.code,i["source"]=3,i["formId"]=t.detail.formId,i=Object.assign(i,o),this.$api.createOrder(i,function(t){t.status?(e.submitStatus=!1,e.$common.redirectTo("/pages/goods/payment/index?order_id="+t.data.order_id+"&type="+e.orderType)):(e.$common.errorToShow(t.msg),e.submitStatus=!1)})},goInvoice:function(){this.$common.navigateTo("./invoice")},showAddressList:function(){this.$common.navigateTo("/pages/member/address/list?type=order")},onClickItem:function(t){this.current!==t&&(this.current=t)},getDefaultStore:function(){var t=this;this.$api.defaultStore({},function(e){if(e.status){var s={id:e.data.id,name:e.data.store_name,mobile:e.data.store_mobile,address:e.data.all_address};t.store=s}})}},computed:{productNums:function(){var t=0;for(var e in this.cartData.list)this.cartData.list[e].is_select&&(t+=this.cartData.list[e].nums);return t},isOpenPoint:function(){return this.$store.state.config.point_switch},usedCouponsCompute:function(){var t="未使用";if(Object.keys(this.usedCoupons).length){var e=[];for(var s in this.usedCoupons)e.push(this.usedCoupons[s]);t=e.join()}return t},invoiceSwitch:function(){return this.$store.state.config.invoice_switch||2},storeSwitch:function(){return this.$store.state.config.store_switch||2},couponIsUsed:function(){return this.cartData.coupon instanceof Array}},watch:{params:{handler:function(){this.getCartList()},deep:!0}}};e.default=n}).call(this,s("543d")["default"])},5721:function(t,e,s){"use strict";var i=s("1c90"),o=s.n(i);o.a},b96b:function(t,e,s){"use strict";s.r(e);var i=s("0aa2"),o=s("2e5a");for(var a in o)"default"!==a&&function(t){s.d(e,t,function(){return o[t]})}(a);s("5721");var c=s("2877"),n=Object(c["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},f3e3:function(t,e,s){"use strict";s("faac");var i=a(s("b0ce")),o=a(s("b96b"));function a(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(o.default))}},[["f3e3","common/runtime","common/vendor"]]]);