(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/index/index"],{"0bdd":function(t,s,a){"use strict";var i=function(){var t=this,s=t.$createElement,a=t._self._c||s;return t.cartData.list&&t.cartData.list.length>0?a("view",{staticClass:"content"},[a("view",{staticClass:"content-top"},[a("view",{staticClass:"cell-group margin-cell-group"},[a("view",{staticClass:"cell-item"},[t._m(0),a("view",{staticClass:"cell-item-bd"},[a("text",{staticClass:"cell-bd-text"},[t._v(t._s(t.shopName))])]),a("view",{staticClass:"cell-item-ft"},[t.editStatus?a("text",{staticClass:"cell-bd-text",attrs:{eventid:"9871030a-0"},on:{click:t.editNoBtn}},[t._v("完成")]):a("text",{staticClass:"cell-bd-text",attrs:{eventid:"9871030a-1"},on:{click:t.editBtn}},[t._v("编辑")])])])]),a("view",{staticClass:"img-list cart-list"},t._l(t.cartData.list,function(s,i){return a("checkbox-group",{key:i,staticClass:"cart-checkbox",attrs:{val:s.id,eventid:"9871030a-5-"+i,mpcomid:"9871030a-1-"+i},on:{change:function(a){t.checkboxChange(s.id)}}},[a("view",{},[a("label",{staticClass:"uni-list-cell uni-list-cell-pd"},[a("view",{staticClass:"cart-checkbox-c"},[s.stockNo?a("checkbox",{staticClass:"checkboxNo",attrs:{color:"#FF7159",checked:s.is_select,value:s.id,disabled:s.stockNo}}):a("checkbox",{attrs:{color:"#FF7159",checked:s.is_select,value:s.id}})],1)]),a("view",{staticClass:"img-list-item"},[a("image",{staticClass:"img-list-item-l little-img have-none",attrs:{src:s.products.image_path,mode:"aspectFill"}}),a("view",{staticClass:"img-list-item-r little-right"},[a("view",{staticClass:"little-right-t"},[a("view",{staticClass:"goods-name list-goods-name",attrs:{eventid:"9871030a-2-"+i},on:{click:function(a){t.goodsDetail(s.products.goods_id)}}},[t._v(t._s(s.products.name))]),a("view",{staticClass:"goods-price red-price"},[t._v("￥"+t._s(s.products.price))])]),s.products.promotion_list?a("view",{staticClass:"romotion-tip"},t._l(s.products.promotion_list,function(s,i){return a("view",{key:i,staticClass:"romotion-tip-item",class:2!==s.type?"bg-gray":""},[t._v(t._s(s.name))])})):t._e(),a("view",{staticClass:"goods-item-c"},[a("view",{staticClass:"goods-buy"},[s.products.spes_desc?a("view",{staticClass:"goods-salesvolume"},[t._v(t._s(s.products.spes_desc))]):a("view",{staticClass:"goods-salesvolume"}),a("view",{staticClass:"goods-numbox"},[s.stockNo&&!t.editStatus?a("text",{staticClass:"stockError"},[t._v("库存不足")]):s.stockTension&&!t.editStatus?a("text",{staticClass:"stockError stockTension"},[t._v("库存紧张")]):t._e(),t.editStatus?a("view",{staticClass:"click-del",attrs:{eventid:"9871030a-3-"+i},on:{click:function(a){t.del(i,s.id)}}},[a("image",{staticClass:"icon",attrs:{src:"/static/image/delete.png",mode:""}})]):a("uni-number-box",{attrs:{min:1,max:s.maxStock,value:s.nums,eventid:"9871030a-4-"+i,mpcomid:"9871030a-0-"+i},on:{change:function(a){t.bindChange(a,s)}}})],1)])])])])],1)])}))]),a("view",{staticClass:"cart-bottom"},[a("checkbox-group",{staticClass:"cart-checkbox",attrs:{eventid:"9871030a-8",mpcomid:"9871030a-2"},on:{change:t.checkboxAllButton}},[a("label",{staticClass:"uni-list-cell uni-list-cell-pd"},[a("view",{staticClass:"cart-checkbox-c"},[a("checkbox",{attrs:{checked:t.checkboxAll,color:"#FF7159"}}),t._v("全选")],1)]),a("view",{staticClass:"cart-bottom-right"},[t.editStatus?t._e():a("view",{staticClass:"cart-bottom-right-t"},[t._v("合计："),a("view",{staticClass:"goods-price red-price"},[t._v("￥"+t._s(t.cartData.amount))])]),t.editStatus?a("view",[a("button",{staticClass:"btn btn-square btn-b",attrs:{eventid:"9871030a-6"},on:{click:t.delList}},[t._v("删除")])],1):a("button",{staticClass:"btn btn-square btn-b",attrs:{"hover-class":"btn-hover2",eventid:"9871030a-7"},on:{click:t.settlement}},[t._v("去结算")])],1)],1)],1)]):a("view",{staticClass:"cart-none"},[a("image",{staticClass:"cart-none-img",attrs:{src:"/static/image/car.png",mode:""}}),a("view",{staticClass:"cart-none-t"},[t._v("购物车快饿瘪了 T.T")]),a("view",{staticClass:"cart-none-m"},[t._v("快给我挑点宝贝吧")]),a("navigator",{staticClass:"cart-none-b",attrs:{url:"../../index/index","hover-class":"btn-hover","open-type":"switchTab"}},[t._v("去逛逛")])],1)},e=[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("view",{staticClass:"cell-item-hd"},[a("image",{staticClass:"cell-hd-icon",staticStyle:{width:"32rpx",height:"32rpx"},attrs:{src:"/static/image/homepage.png"}})])}];a.d(s,"a",function(){return i}),a.d(s,"b",function(){return e})},"12fc":function(t,s,a){"use strict";a.r(s);var i=a("5481"),e=a.n(i);for(var c in i)"default"!==c&&function(t){a.d(s,t,function(){return i[t]})}(c);s["default"]=e.a},4419:function(t,s,a){},5481:function(t,s,a){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=c(a("dd9c")),e=a("1fc7");function c(t){return t&&t.__esModule?t:{default:t}}var o={mixins:[e.goods],data:function(){return{startX:0,startY:0,cartData:{},cartIds:[],checkboxAll:!1,total:0,goSettlement:!1,cartId:"",cartNum:"",isLoad:!1,cartNums:0,editStatus:!1}},components:{uniNumberBox:i.default},onShow:function(){var t=this.$db.get("userToken");t&&this.getCartData()},computed:{shopName:function(){return this.$store.state.config.shop_name},goods_stocks_warn:function(){return this.$store.state.config.goods_stocks_warn}},methods:{checkboxChange:function(t){var s=this,a=t,i=s.cartData;for(var e in i.list)i.list[e].id==a&&(1==i.list[e].is_select?i.list[e].is_select=!1:i.list[e].is_select=!0);s.cartData=i,s.setNumsData(),s.isAllCheckbox()},arrayToStr:function(t){return t.toString()},getCartData:function(){var t=this,s=t.arrayToStr(t.cartIds),a={ids:s,display:"all"};this.$api.cartList(a,function(s){if(s.status){var a=s.data;t.showHandle(a)}})},showHandle:function(t){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this,i=!1;for(var e in t.list){t.list[e].nums<1&&(t.list[e].nums=1);var c=!1,o=t.list[e].products.stock;t.list[e].nums>t.list[e].products.stock&&(c=!0,o=t.list[e].nums),t.list[e].maxStock=o,t.list[e].stockNo=c;var n=!1;if(a.goods_stocks_warn>=t.list[e].products.stock&&(n=!0),t.list[e].stockTension=n,t.list[e].minStatus="normal",t.list[e].maxStatus="normal",1==t.list[e].nums&&(t.list[e].minStatus="disabled"),t.list[e].nums==t.list[e].products.stock&&(t.list[e].maxStatus="disabled"),t.list[e].spes=[],null!=t.list[e].products.spes_desc){var r=t.list[e].products.spes_desc.split(",");for(var l in r){var u=r[l].split(":");t.list[e].spes.push(u[1])}}t.list[e].isTouchMove=!1,t.list[e].is_select&&(i=!0),t.list[e].id=a.arrayToStr(t.list[e].id),s&&t.list[e].is_select&&a.cartIds.indexOf(t.list[e].id)<0&&a.cartIds.push(t.list[e].id)}t.goods_pmt=a.$common.formatMoney(t.goods_pmt,2,""),t.order_pmt=a.$common.formatMoney(t.order_pmt,2,""),t.amount=a.$common.formatMoney(t.amount,2,"");var d=!1;t.list.length<1&&(d=!0);var m=0;for(var v in t.promotion_list)m++;a.goSettlement=i,a.isLoad=d,a.cartNums=m,s?a.cartData=t:a.getCartData(),a.isAllCheckbox()},isAllCheckbox:function(){var t=this,s=t.cartData.list,a=!1,i=!0;for(var e in s)0==s[e].is_select&&0==s[e].stockNo&&(i=!1),1==s[e].is_select&&(a=!0);s.length<=0&&(i=!1),t.checkboxAll=i,t.goSettlement=a},checkboxAllButton:function(t){1==this.checkboxAll?(this.checkboxAll=!1,this.setAllCheckbox(!1)):(this.checkboxAll=!0,this.setAllCheckbox(!0))},setAllCheckbox:function(t){var s=this,a=s.cartData;if(t)for(var i in a.list)0==a.list[i].stockNo&&(a.list[i].is_select=!0);else for(var e in a.list)a.list[e].is_select=!1;s.cartData=a,s.setNumsData(),s.isAllCheckbox()},setNumsData:function(){var t=this,s=t.cartData,a=[];for(var i in s.list)s.list[i].is_select&&a.push(s.list[i].id);if(t.cartIds=a,t.cartData=s,0==a.length){var e=t.cartData;for(var c in e.promotion_list)e.promotion_list[c].type=1;e.goods_pmt="0.00",e.order_pmt="0.00",e.amount="0.00",t.cartData=e}else t.getCartData()},bindChange:function(t,s){var a=this,i=s.id,e=t,c=a.cartData,o=!1;for(var n in c.list)c.list[n].id==i&&e<=c.list[n].products.stock&&(c.list[n].nums=e,o=!0);return o&&(a.cartData=c,a.cartId=i,a.cartNum=e,a.$common.throttle(a.bindCartNumberOperation,a,350)),!1},bindCartNumberOperation:function(){var t=this;t.setCartNum(t.cartId,t.cartNum)},setCartNum:function(t,s){var a=this,i={id:t,nums:s};a.$api.setCartNum(i,function(s){a.cartIds.indexOf(t)>-1?s.status?a.$nextTick(function(){a.showHandle(s.data,!1)}):a.$common.errorToShow(s.msg):a.$nextTick(function(){a.showHandle(s.data,!1)})})},del:function(t,s){var a=this,i=s;a.cartData.list.splice(t,1),a.cartData=a.cartData,a.isLoad=!0;var e={ids:i};a.$api.removeCart(e,function(t){t.status&&a.$common.successToShow(t.msg),a.setNumsData(),a.isAllCheckbox()})},collection:function(s){var a=this;app.db.userToken(function(i){var e={goods_id:s.currentTarget.dataset.goodsid};app.api.goodsCollection(e,function(i){for(var e in a.cartData.list)a.cartData.list[e].products.goods_id==s.currentTarget.dataset.goodsid&&("收藏成功"==i.msg?a.cartData.list[e].isCollection=!0:a.cartData.list[e].isCollection=!1);wx.showToast({title:i.msg,complete:function(){setTimeout(function(){t.hideToast()},1e3)}})})})},settlement:function(t){var s=this;if(s.goSettlement){var a=s.cartData.list,i="";for(var e in a)1==a[e].is_select&&(i+=","+a[e].id);if(","==i.substr(0,1)&&(i=i.substr(1)),i.length>0)return s.$common.navigateTo("/pages/goods/place-order/index?cart_ids="+JSON.stringify(i)),!0}},touchstart:function(t){var s=this;s.cartData.list.forEach(function(t,s){t.isTouchMove&&(t.isTouchMove=!1)}),s.setData({startX:t.changedTouches[0].clientX,startY:t.changedTouches[0].clientY,cartData:s.cartData})},touchmove:function(t){var s=this,a=t.currentTarget.dataset.index,i=s.startX,e=s.startY,c=t.changedTouches[0].clientX,o=t.changedTouches[0].clientY,n=s.angle({X:i,Y:e},{X:c,Y:o});s.cartData.list.forEach(function(t,s){t.isTouchMove=!1,Math.abs(n)>30||s==a&&(t.isTouchMove=!(c>i))}),s.setData({cartData:s.cartData})},angle:function(t,s){var a=s.X-t.X,i=s.Y-t.Y;return 360*Math.atan(i/a)/(2*Math.PI)},editBtn:function(){this.editStatus=!0},editNoBtn:function(){var t=this;this.editStatus=!1;var s=!1;for(var a in t.cartData.list)if(t.cartData.list[a].is_select){s=!0;break}s&&t.getCartData()},delList:function(){var t=this,s=[];for(var a in t.cartData.list)t.cartData.list[a].is_select&&(s+=t.cartData.list[a].id+",");var i={ids:s};t.$api.removeCart(i,function(s){s.status&&t.$common.successToShow(s.msg),t.setNumsData(),t.isAllCheckbox()})}}};s.default=o}).call(this,a("543d")["default"])},"64a4":function(t,s,a){"use strict";a.r(s);var i=a("0bdd"),e=a("12fc");for(var c in e)"default"!==c&&function(t){a.d(s,t,function(){return e[t]})}(c);a("8bbb");var o=a("2877"),n=Object(o["a"])(e["default"],i["a"],i["b"],!1,null,null,null);s["default"]=n.exports},"8bbb":function(t,s,a){"use strict";var i=a("4419"),e=a.n(i);e.a},"99a6":function(t,s,a){"use strict";a("faac");var i=c(a("b0ce")),e=c(a("64a4"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(e.default))}},[["99a6","common/runtime","common/vendor"]]]);