(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/form/detail/form"],{2507:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(s("dfe5")),a=o(s("f557"));function o(t){return t&&t.__esModule?t:{default:t}}var c={name:"",components:{areaPicker:i.default,lvvPopup:a.default},props:{},data:function(){return{formId:"",form:{head_type:1,head_type_value_url:""},showPage:!0,hiddenForm:!0,indicatorDots:!0,autoplay:!0,interval:3e3,duration:500,slideImg:[],minusStatus:"disabled",animationData:{},opacityData:{},hide:"animathide",formMoney:0,region:["河南省","郑州市","中原区"],areaId:410102,pickerValue:"",defaultIndex:[0,0,0],pics:[],goodsNums:0,cart:[],currentKey:0,currentGoodsId:0,goodsTotalMoney:"0.00",originForm:[],paymentType:"",payment_type:"",goodsSpesDesc:"",productId:"",status:"",goodsInfoName:"",goodsInfoPrint:"",goodsInfoNumber:"",select_goods_id:"",select_id:"",showSpecs:!1,submitStatus:!1}},onLoad:function(t){var e=t.id;if(!e)return this.$common.errorToShow("路径错误"),!1;this.formId=e,this.$db.set("formId",e)},onShow:function(){this.getFormDetail()},methods:{showThreePicker:function(){this.pickerValue=this.region[0]+" "+this.region[1]+" "+this.region[2],this.$refs.areaPicker[0].showPicker()},onConfirm:function(e){var s=this,i=e[0].name,a=e[1].name,o=e[2].name;this.pickerValue=e[0].name+" "+e[1].name+" "+e[2].name;var c={province_name:i,city_name:a,county_name:o};this.$api.getAreaId(c,function(e){e.status?s.areaId=e.data:t.showModal({title:"提示",content:"地区选择出现问题，请重新选择地区",showCancel:!1})})},getFormDetail:function(){var e=this,s={id:this.formId,token:this.$db.get("userToken")},i=this;this.$api.getFormDetial(s,function(s){s.status?(e.form=s.data,e.originForm=s.data,"1"!=s.data.type&&"2"!=s.data.type||("1"==s.data.type?i.payment_type=e.$config.paymentType.form_order:"2"==s.data.type&&(i.payment_type=e.$config.paymentType.form_pay)),t.setNavigationBarTitle({title:s.data.name})):(e.showPage=!1,"undefined"==typeof s.data.need_login?t.showModal({title:"提示",content:"表单已过期，请扫描新的二维码",showCancel:!1,success:function(e){e.confirm&&t.switchTab({url:"../../index/index"})}}):(e.$store.commit({type:"redirect",page:"/pages/form/detail/form?id="+e.formId}),e.$common.jumpToLogin()))})},bindDateChange:function(t,e){e.default_value=t.target.value},bindTimeChange:function(t,e){e.default_value=t.target.value},radioChange:function(t,e){e.default_value=t.detail.value},checkboxChange:function(t,e){for(var s=t.detail.value,i=0;i<e.checbox_value.length;++i){var a=e.checbox_value[i];s.includes(a.value)?this.$set(a,"checked",!0):this.$set(a,"checked",!1)}},bindMinus:function(){this.goodsNums>1?this.goodsNums--:this.goodsNums=0},bindPlus:function(){this.goodsNums>=this.goodsInfoNumber?this.goodsNums=this.goodsInfoNumber:this.goodsNums++},bindManual:function(t){this.num=t.detail.value},chooseLocation:function(t,e){wx.chooseLocation({success:function(t){e.default_value=t.latitude+","+t.longitude},fail:function(t){wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]||wx.openSetting()}})}})},pic_choose:function(t,e,s){var i=this,a=this;this.$api.uploadImage(5,function(t){t.status?(e.pics||(e.pics=[]),e.pics.push({src:t.data.url.replace(/\\/g,"/"),image_id:t.data.image_id}),i.$set(i.form.items,s,e),a.$common.successToShow(t.msg)):a.$common.errorToShow(t.msg)})},pic_del:function(t,e,s){t.pics.splice(s,1),this.$set(this.form.items,e,t)},formSubmit:function(t){var e=this,s=this,i=t.detail.value;if(1==this.form.type){if(this.cart.length<1)return this.$common.errorToShow("请先选择商品"),!0;var a=[];this.cart.forEach(function(t,e,s){a[t.key+"_"+e]=t}),i=Object.assign(i,a)}var o=this.$db.get("userToken"),c={data:i,id:this.form.id,token:o};this.submitStatus=!0,this.$api.addSubmitForm(c,function(t){e.submitStatus=!1,t.status?"1"==s.form.type||"2"==s.form.type?(s.$common.successToShow(t.msg),setTimeout(function(){s.$common.redirectTo("/pages/goods/payment/index?form_id="+t.data.id+"&type="+s.payment_type+"&recharge="+t.data.money)},1e3)):(s.formReset(),s.$common.successToShow(t.msg),setTimeout(function(){wx.switchTab({url:"../../index/index"})},1500)):e.$common.errorToShow(t.msg)})},formReset:function(t){this.$db.set("formId",""),this.cart=[],this.form=this.originForm},closeModal:function(){this.$refs.lvvpopref.close()},specifications:function(t,e){this.$refs.lvvpopref.show(),this.showSpecs=!0,this.select_id=t.target.dataset.id,this.select_goods_id=t.target.dataset.goods,this.currentKey=t.target.dataset.id,this.currentGoodsId=t.target.dataset.goods,this.getGoodsInfo(e)},getGoodsInfo:function(t){var e=t.goods;this.goodsSpesDesc=this.getSpes(e.product),this.productId=e.product.id,this.goodsInfoName=e.product.name,this.goodsInfoPrint=e.product.price,this.goodsInfoNumber=e.product.stock,this.goodsNums=this.getNumsByKey(this.currentKey,e.product.id),this.status=!(e.product.stock<1)},getNumsByKey:function(t,e){var s=this;if(s.cart.length<1)return 0;for(var i=0;i<s.cart.length;i++)if(s.cart[i].key==t&&s.cart[i].productId==e)return s.cart[i].nums;return 0},goodsAddCart:function(){var t=this.productId,e=this.currentKey;if(this.cart.length<1)this.cart.push({key:e,productId:t,goodsId:this.select_goods_id,nums:this.goodsNums,price:this.goodsInfoPrint});else{for(var s=!1,i=0;i<this.cart.length;i++)this.cart[i].key==e&&this.cart[i].productId==t&&(this.cart[i]={key:e,productId:t,goodsId:this.select_goods_id,nums:this.goodsNums,price:this.goodsInfoPrint},s=!0);s||this.cart.push({key:e,productId:t,goodsId:this.select_goods_id,nums:this.goodsNums,price:this.goodsInfoPrint})}this.showSpecs=!1,this.$refs.lvvpopref.close(),this.getCartNums()},getCartNums:function(){for(var t=this.form.items,e="",s=0,i=t.length;s<i;++s)t[s].id==this.currentKey&&(e=s);var a=this;if(this.form.items[e].goods.id==this.currentGoodsId)if(this.form.items[e].cart_count>0){var o=0,c=this.currentKey;this.cart.forEach(function(t,s,i){t.key==c&&(o+=t.nums),a.form.items[e].cart_count=o})}else this.form.items[e].cart_count=this.goodsNums;else this.form.items[e].cart_count=this.goodsNums;this.getGoodsTotalMoney()},getGoodsTotalMoney:function(){var t=0;this.cart.forEach(function(e,s,i){t+=e.price*e.nums}),this.goodsTotalMoney=this.$common.formatMoney(t,2,"")},getSpes:function(t){return t.default_spes_desc?t.default_spes_desc:[]},selectSku:function(t){var e=this,s=t.target.dataset.key;this.$api.getProductInfo({id:s},function(t){t.status&&(e.goodsSpesDesc=e.getSpes(t.data),e.productId=t.data.id,e.goodsInfoName=t.data.name,e.goodsInfoPrint=t.data.price,e.goodsInfoNumber=t.data.stock,e.goodsNums=e.getNumsByKey(e.currentKey,t.data.id),e.status=!(t.data.stock<1))})}},onShareAppMessage:function(){var t=this.$db.get("userToken"),e=this.$common.shareParameterDecode("type=10&id="+this.formId+"&invite="+t),s="/pages/share/jump?scene="+e;return{title:this.form.name,path:s}}};e.default=c}).call(this,s("543d")["default"])},"2aed":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{directives:[{name:"show",rawName:"v-show",value:t.showPage,expression:"showPage"}]},[s("form",{attrs:{bindreset:"formReset",eventid:"2e02d88c-14"},on:{submit:t.formSubmit}},[s("view",{staticClass:"content"},[1==t.form.head_type?s("view",[s("view",{staticClass:"banner"},[s("image",{attrs:{src:t.form.head_type_value_url[0],mode:"widthFix"}})])]):2==t.form.head_type?s("view",[s("view",[s("view",{staticClass:"sw"},[s("swiper",t._l(t.form.head_type_value_url,function(t,e){return s("swiper-item",{key:e,attrs:{mpcomid:"2e02d88c-0-"+e}},[s("image",{staticClass:"slide-image",attrs:{src:t,mode:"widthFix"}})])}))],1)])]):3==t.form.head_type?s("view",[s("view",{staticClass:"video"},[s("video",{attrs:{src:t.form.head_type_video_url[0],poster:t.form.head_type_value_url[0]}})])]):t._e(),""!=t.form.desc?s("view",[s("view",{staticClass:"plaintext"},[s("text",[t._v(t._s(t.form.desc))])])]):t._e(),s("view",{staticClass:"input-box"},t._l(t.form.items,function(e,i){return s("view",{key:i},["goods"==e.type?s("view",{staticClass:"goods-box-item"},[s("image",{staticClass:"goods-img",attrs:{src:e.goods.image_url,mode:"aspectFit"}}),s("view",{staticClass:"goods-right"},[s("view",{staticClass:"goods-name"},[t._v(t._s(e.name))]),s("view",{staticClass:"goods-mid"},[s("text",[t._v("已售"+t._s(e.goods.buy_count))])]),s("view",{staticClass:"goods-buttom"},[s("view",{staticClass:"goods-price"},[t._v("￥"+t._s(e.goods.price))]),s("view",{staticClass:"choose-specs",attrs:{"data-type":"1","data-goods":e.goods.id,"data-id":e.id,"data-statu":"openspecs",eventid:"2e02d88c-0-"+i},on:{click:function(s){t.specifications(s,e)}}},[t._v("选规格")]),e.cart_count>0?s("text",{staticClass:"order-num"},[t._v(t._s(e.cart_count))]):t._e()])])]):t._e(),"text"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.default_value,expression:"item.default_value"}],staticClass:"ib-item-input",attrs:{type:"text",name:""+e.id,"data-id":e.id,"placeholder-class":"ib-item-input-c",placeholder:"请输入"+e.name,eventid:"2e02d88c-1-"+i},domProps:{value:e.default_value},on:{input:function(t){t.target.composing||(e.default_value=t.target.value)}}})])]):t._e(),"date"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("picker",{attrs:{mode:"date",name:""+e.id,value:e.default_value,start:"1949-10-01",end:"2019-10-01","data-id":e.id,eventid:"2e02d88c-2-"+i},on:{change:function(s){t.bindDateChange(s,e)}}},[s("view",[t._v(t._s(e.default_value))])]),s("image",{staticClass:"icon-img-right",attrs:{src:"/static/image/ic-unfold.png"}})],1)])]):t._e(),"time"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("picker",{staticClass:"weui-btn",attrs:{name:""+e.id,mode:"time",value:e.default_value,start:"09:01",end:"21:01","data-id":e.id,eventid:"2e02d88c-3-"+i},on:{change:function(s){t.bindTimeChange(s,e)}}},[s("view",[t._v(t._s(e.default_value))])]),s("image",{staticClass:"icon-img-right",attrs:{src:"/static/image/ic-unfold.png"}})],1)])]):t._e(),"checbox"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"checkout-list"},[s("checkbox-group",{attrs:{"data-value":e.id,name:""+e.id,eventid:"2e02d88c-4-"+i,mpcomid:"2e02d88c-1-"+i},on:{change:function(s){t.checkboxChange(s,e)}}},t._l(e.checbox_value,function(e,i){return s("label",{key:i,staticClass:"checkout-item"},[s("view",{staticClass:"checkout-item-c",class:e.checked?"black":""},[s("checkbox",{attrs:{value:e.value,checked:e.checked}}),t._v(t._s(e.value))],1)])}))],1)])]):t._e(),"radio"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+":")])]),s("view",{staticClass:"ib-item-right"},[s("radio-group",{staticClass:"uni-list",attrs:{"data-value":e.id,name:""+e.id,eventid:"2e02d88c-5-"+i,mpcomid:"2e02d88c-2-"+i},on:{change:function(s){t.radioChange(s,e)}}},t._l(e.radio_value,function(i,a){return s("label",{key:a,staticClass:" uni-list-cell uni-list-cell-pd "},[s("view",{staticClass:"invoice-type-icon"},[i==e.default_value?s("radio",{staticClass:"a-radio",attrs:{id:i,value:i,checked:"true"}}):t._e(),i!=e.default_value?s("radio",{staticClass:"a-radio",attrs:{id:i,value:i}}):t._e()],1),s("view",{staticClass:"invoice-type-c"},[s("label",{staticClass:"label-2-text",attrs:{for:i}},[s("text",[t._v(t._s(i))])])],1)])}))],1)]):t._e(),"area"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("input",{staticClass:"fsz26",attrs:{value:t.pickerValue,name:""+e.id,eventid:"2e02d88c-6-"+i},on:{focus:t.showThreePicker}}),s("area-picker",{ref:"areaPicker",refInFor:!0,staticClass:"fsz26",attrs:{areaId:t.areaId,defaultIndex:t.defaultIndex,eventid:"2e02d88c-7-"+i,mpcomid:"2e02d88c-3-"+i},on:{onConfirm:t.onConfirm}})],1)])]):t._e(),"money"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.default_value,expression:"item.default_value"}],staticClass:"ib-item-input",attrs:{type:"digit",name:""+e.id,"placeholder-class":"ib-item-input-c",placeholder:"请输入"+e.name,eventid:"2e02d88c-8-"+i},domProps:{value:e.default_value},on:{input:function(t){t.target.composing||(e.default_value=t.target.value)}}})])])]):t._e(),"password"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.default_value,expression:"item.default_value"}],staticClass:"ib-item-input",attrs:{type:"password",name:""+e.id,"placeholder-class":"ib-item-input-c",placeholder:"请输入"+e.name,eventid:"2e02d88c-9-"+i},domProps:{value:e.default_value},on:{input:function(t){t.target.composing||(e.default_value=t.target.value)}}})])])]):t._e(),"image"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"form-input-box-title"},[t._v("上传"+t._s(e.name))]),s("view",{staticClass:"form-multiple-rows"},[s("view",{staticClass:"f-m-r-item"},[s("view",{staticClass:"upload-img-list"},[s("view",{staticClass:"upload-img-bd"},t._l(e.pics,function(a,o){return s("view",{key:o,staticClass:"upload-img"},[s("image",{staticClass:"del-img",attrs:{"data-index":o,src:"/static/image/del.png",eventid:"2e02d88c-10-"+i+"-"+o},on:{click:function(s){t.pic_del(e,i,o)}}}),s("image",{staticClass:"upload-camera",attrs:{src:a.src,mode:"aspectFit"}}),s("input",{directives:[{name:"model",rawName:"v-model",value:a.image_id,expression:"pic_item.image_id"}],attrs:{type:"text",hidden:"hidden",name:e.id+"_"+o,eventid:"2e02d88c-11-"+i+"-"+o},domProps:{value:a.image_id},on:{input:function(t){t.target.composing||(a.image_id=t.target.value)}}})])})),s("view",{staticClass:"upload-img-hd"},[s("image",{staticClass:"upload-camera",attrs:{src:"/static/image/camera.png","data-id":e.id,eventid:"2e02d88c-12-"+i},on:{click:function(s){t.pic_choose(s,e,i)}}})])])])])]):t._e(),"textarea"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"form-input-box-title"},[t._v(t._s(e.name))]),s("view",{staticClass:"form-multiple-rows"},[s("view",{staticClass:"f-m-r-item form-input-box-item"},[s("textarea",{staticClass:"ib-item-textarea",attrs:{name:""+e.id,placeholder:"请输入"+e.name,"placeholder-class":"ib-item-input-c"}})])])]):t._e(),"coordinate"==e.type?s("view",{staticClass:"form-input-box-item"},[s("view",{staticClass:"ib-item-left"},[s("text",[t._v(t._s(e.name)+"：")])]),s("view",{staticClass:"ib-item-right"},[s("view",{staticClass:"ib-item-mid"},[s("image",{staticClass:"icon-img",attrs:{src:"/static/image/ic-location.png"}}),s("input",{staticClass:"ib-item-input margin-r",attrs:{"placeholder-class":"ib-item-input-c",name:""+e.id,value:e.default_value,disabled:"disabled",placeholder:"点击获取位置信息","data-id":e.id,eventid:"2e02d88c-13-"+i},on:{click:function(s){t.chooseLocation(s,e)}}})])])]):t._e()])})),1==t.form.type?s("view",{staticClass:"goods-bottom"},[s("text",{staticClass:"goods-total"},[t._v("合计"),s("text",{staticClass:"goods-total-r"},[t._v("￥"+t._s(t.goodsTotalMoney))])])]):t._e()]),s("view",{staticClass:"bottom-btn"},[s("button",{style:{backgroundColor:t.form.button_color},attrs:{"data-statu":"open","form-type":"submit",disabled:t.submitStatus,loading:t.submitStatus}},[t._v(t._s(t.form.button_name))])],1)]),s("lvv-popup",{ref:"lvvpopref",staticClass:"lvvpopref",attrs:{position:"bottom",mpcomid:"2e02d88c-4"}},[t.showSpecs?s("block",[s("view",{staticClass:"modal-body",attrs:{"data-statu":"closespecs",catchtouchmove:"move"}},[s("view",{staticClass:"specs-goods-t"},[s("view",{staticClass:"specs-goods-information"},[s("text",{staticClass:"specs-goods-name"},[t._v(t._s(t.goodsInfoName))]),s("text",{staticClass:"specs-goods-price"},[t._v("￥"+t._s(t.goodsInfoPrint))])]),s("view",{staticClass:"close-btn",attrs:{"data-goods":t.select_goods_id,"data-id":t.select_id,"data-type":"100","data-statu":"closespecs",eventid:"2e02d88c-15"},on:{click:t.closeModal}},[s("image",{attrs:{src:"/static/image/close.png"}})])]),s("scroll-view",{staticClass:"specs-goods-c",attrs:{"scroll-y":"true"}},[t._l(t.goodsSpesDesc,function(e,i){return s("view",{key:i,staticClass:"color"},[s("text",{staticClass:"salespromotion-service-name"},[t._v(t._s(i))]),s("view",{staticClass:"salespromotion-service-b"},t._l(e,function(e,a){return s("block",{key:a},[e.is_default?s("view",{staticClass:"pitch-on"},[t._v(t._s(e.name))]):0!=e.product_id?s("view",{class:e.is_default?"pitch-on":"",attrs:{"data-key":e.product_id,"data-id":e.name,eventid:"2e02d88c-16-"+i+"-"+a},on:{click:t.selectSku}},[t._v(t._s(e.name))]):s("view",{staticClass:"nothing"},[t._v(t._s(e.name))])])}))])}),s("view",{staticClass:"number"},[s("text",{staticClass:"salespromotion-service-name"},[t._v("数量")]),s("view",{staticClass:"stepper"},[s("text",{class:0==t.goodsNums?"disabled":"normal",attrs:{eventid:"2e02d88c-17"},on:{click:t.bindMinus}},[t._v("-")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.goodsNums,expression:"goodsNums"}],attrs:{type:"number",eventid:"2e02d88c-18"},domProps:{value:t.goodsNums},on:{change:t.bindManual,input:function(e){e.target.composing||(t.goodsNums=e.target.value)}}}),s("text",{class:t.goodsNums==t.goodsInfoNumber?"disabled":"normal",attrs:{eventid:"2e02d88c-19"},on:{click:t.bindPlus}},[t._v("+")])])])],2),s("view",{staticClass:"detail-footer"},[t.status?s("view",{staticClass:"detail-footer-right determine-next"},[s("view",{staticClass:"next",attrs:{eventid:"2e02d88c-20"},on:{click:t.goodsAddCart}},[t._v("下一步")])]):s("view",{staticClass:"detail-footer-right"},[s("view",{staticClass:"stockno"},[t._v("该商品已售罄")])])])],1)]):t._e()],1)],1)},a=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return a})},"3f50":function(t,e,s){"use strict";s("faac");var i=o(s("b0ce")),a=o(s("588e"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},"588e":function(t,e,s){"use strict";s.r(e);var i=s("2aed"),a=s("fc2a");for(var o in a)"default"!==o&&function(t){s.d(e,t,function(){return a[t]})}(o);s("a3dc");var c=s("2877"),n=Object(c["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},a3dc:function(t,e,s){"use strict";var i=s("d747"),a=s.n(i);a.a},d747:function(t,e,s){},fc2a:function(t,e,s){"use strict";s.r(e);var i=s("2507"),a=s.n(i);for(var o in i)"default"!==o&&function(t){s.d(e,t,function(){return i[t]})}(o);e["default"]=a.a}},[["3f50","common/runtime","common/vendor"]]]);